# 어음 관리 기능 종합 검토 보고서

## 📋 현재 구현 현황

### 1. 데이터베이스 스키마
- **테이블**: `payments`, `collections`
- **어음 관련 필드**:
  - `bill_number` (어음번호) - VARCHAR, nullable
  - `bill_date` (어음 만기일) - DATE, nullable
  - `bill_drawer` (어음 발행자) - VARCHAR, nullable
  - `payment_method` - 'BILL' 옵션 포함

### 2. API 구현
- ✅ `/api/payments` - 지급 관리 API (어음 필드 지원)
- ✅ `/api/collections` - 수금 관리 API (어음 필드 지원)
- ✅ 스키마 검증에 어음 필드 포함

### 3. UI 구현
- ✅ `PaymentForm.tsx` - 지급 폼에 어음 필드 존재
- ✅ `CollectionForm.tsx` - 수금 폼에 어음 필드 존재
- ✅ `payment_method`에 'BILL' 옵션 포함

## 🔍 발견된 문제점

### 1. UI/UX 문제
- ✅ 어음 선택 시 어음 관련 필드가 조건부로 표시됨 (이미 구현됨)
- ❌ 어음 만기일 알림 기능 없음
- ❌ 어음 상태 관리 없음 (발행/만기/지급완료 등)
- ❌ 어음 목록 조회 기능 없음
- ⚠️ 어음 발행자(bill_drawer) 필드가 선택사항으로 되어 있으나 실제로는 필수일 수 있음

### 2. 기능적 문제
- ❌ 어음별 상세 관리 기능 없음
- ❌ 어음 만기일 추적 및 알림 없음
- ❌ 어음 할인/양도 기능 없음
- ❌ 어음 통계/리포트 없음

### 3. 회계 처리 문제
- ❌ 어음 수취/지급 시 회계 계정 반영 미흡
- ❌ 어음 할인 시 손익 처리 없음
- ❌ 어음 만기 시 자동 처리 없음

## 💡 개선 제안

### 1. 즉시 개선 사항 (High Priority)

#### 1.1 UI 개선
- ✅ `payment_method`가 'BILL'일 때 어음 관련 필드 자동 표시 (이미 구현됨)
- ✅ 어음 필드 필수 입력 검증 추가 (이미 구현됨)
- [ ] 어음 발행자(bill_drawer) 필드 필수 여부 검토 및 적용
- [ ] 어음 만기일이 지급일/수금일 이후인지 검증 추가
- [ ] 어음 만기일 달력 표시 개선 (만기일이 과거인 경우 경고)

#### 1.2 데이터 검증 강화
- [ ] 어음번호 중복 체크 (동일 어음번호로 중복 등록 방지)
- [ ] 어음 만기일이 지급일/수금일 이후인지 검증 (만기일은 미래여야 함)
- [ ] 어음 발행자 정보 필수 입력 여부 결정 및 적용
- [ ] 어음 금액과 거래 금액 일치 여부 검증

### 2. 중기 개선 사항 (Medium Priority)

#### 2.1 어음 관리 기능
- [ ] 어음 목록 조회 페이지 (`/accounting/bills`)
- [ ] 어음 상태 관리 (발행/만기/지급완료/부도)
- [ ] 어음 만기일 알림 기능
- [ ] 어음 검색 및 필터링

#### 2.2 회계 통합
- [ ] 어음 수취 시 "수취어음" 계정 반영
- [ ] 어음 지급 시 "지급어음" 계정 반영
- [ ] 어음 만기 시 자동 계정 전환

### 3. 장기 개선 사항 (Low Priority)

#### 3.1 고급 기능
- [ ] 어음 할인 기능
- [ ] 어음 양도 기능
- [ ] 어음 연체 관리
- [ ] 어음 통계 대시보드

#### 3.2 리포트
- [ ] 어음 현황 리포트
- [ ] 어음 만기 예정 리포트
- [ ] 어음 연체 리포트

## 🎯 우선순위별 구현 계획

### Phase 1: 기본 기능 강화 (1-2주)
1. UI 조건부 표시 개선
2. 데이터 검증 강화
3. 어음 필드 필수 입력 처리

### Phase 2: 어음 관리 기능 (2-3주)
1. 어음 목록 페이지 구현
2. 어음 상태 관리
3. 어음 만기일 알림

### Phase 3: 회계 통합 (3-4주)
1. 회계 계정 연동
2. 자동 분개 처리
3. 재무제표 반영

### Phase 4: 고급 기능 (4-6주)
1. 어음 할인/양도
2. 통계 및 리포트
3. 알림 시스템

## 📊 데이터베이스 개선 제안

### 추가 테이블 제안
```sql
-- 어음 마스터 테이블 (선택사항)
CREATE TABLE promissory_notes (
  note_id SERIAL PRIMARY KEY,
  note_number VARCHAR(50) UNIQUE NOT NULL,
  note_type VARCHAR(20) NOT NULL, -- 'RECEIVABLE' (수취), 'PAYABLE' (지급)
  related_transaction_id INTEGER,
  related_payment_id INTEGER,
  related_collection_id INTEGER,
  drawer_name VARCHAR(100) NOT NULL,
  drawer_account VARCHAR(50),
  payee_name VARCHAR(100),
  note_amount NUMERIC NOT NULL,
  issue_date DATE NOT NULL,
  maturity_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'ACTIVE', -- 'ACTIVE', 'MATURED', 'PAID', 'DEFAULTED'
  discount_rate NUMERIC,
  discount_amount NUMERIC,
  notes TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

## 🔧 즉시 수정 가능한 사항

### 1. PaymentForm.tsx 개선
- `payment_method === 'BILL'`일 때 어음 필드 표시
- 어음 필드 필수 입력 검증

### 2. CollectionForm.tsx 개선
- 동일한 조건부 표시 및 검증

### 3. API 검증 강화
- 어음 선택 시 필수 필드 검증 추가

## 📝 결론

현재 시스템은 어음 관련 기본 필드는 갖추고 있으나, 실제 사용을 위한 UI/UX 개선과 기능 강화가 필요합니다. 특히:

1. **즉시 개선**: UI 조건부 표시 및 검증 강화
2. **단기 개선**: 어음 목록 및 상태 관리 기능
3. **중장기 개선**: 회계 통합 및 고급 기능

어음 관리는 회계의 중요한 부분이므로 체계적인 관리 기능 구현이 필요합니다.

